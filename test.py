import combfit
import numpy as np
from matplotlib import pyplot as plt

if __name__ == "__main__":

    # path to test file with columns (redshift, n(z), n(z) error)
    # fpath = ...
    # data = combfit.DataTuple(*np.loadtxt(fpath).T)
    z = [
        0.08229123, 0.10154756, 0.12363957, 0.14553255, 0.16575928, 0.1891201,
        0.21117827, 0.23314842, 0.25668493, 0.281702,   0.30279036, 0.32634235,
        0.3498777,  0.37622825, 0.40054824, 0.42534464, 0.45163131, 0.47742668,
        0.50416674, 0.53011411, 0.55761914, 0.58522626, 0.61334581, 0.64306848,
        0.67200078, 0.70128045, 0.73144326, 0.76270938, 0.79324727, 0.82719489,
        0.85886074, 0.89185192, 0.92607655, 0.96193725, 0.99670322, 1.0322567,
        1.07046804, 1.10727787, 1.14564091, 1.18547484, 1.22573691, 1.26743443,
        1.3095817,  1.35324748, 1.39578018]
    n = [
        0.36527763, 0.54171675, 0.43508977, 0.86830767, 0.88705882, 0.80475792,
        1.02794144, 1.06598607, 0.95958139, 1.65400613, 1.65042356, 1.24418892,
        1.4016734,  1.38609948, 1.72927473, 1.77862087, 1.82412556, 1.56131351,
        1.64594979, 1.59883174, 1.41014174, 1.49546143, 1.48734829, 1.37110432,
        1.38071544, 1.334537,   1.1652748,  1.03511534, 1.02885324, 1.03131328,
        0.87884972, 1.09918765, 0.86473535, 0.7130648,  0.68809079, 0.86093566,
        0.66986716, 0.56941953, 0.54402179, 0.46084871, 0.40205464, 0.45386312,
        0.3054058,  0.2540251,  0.18932266]
    dn = [
        0.16168477, 0.08773666, 0.11962714, 0.12125553, 0.08864032, 0.12850974,
        0.10801642, 0.10940169, 0.0957262,  0.18276895, 0.1025106,  0.08810887,
        0.09330732, 0.10785836, 0.07912138, 0.10582352, 0.09427435, 0.10693407,
        0.09992529, 0.08466331, 0.08123527, 0.08261194, 0.08669894, 0.07831918,
        0.07621581, 0.08295356, 0.07587183, 0.0796424,  0.08509827, 0.0837658,
        0.0810794,  0.08535462, 0.07482152, 0.07732431, 0.06464227, 0.07993196,
        0.070267,   0.06554679, 0.05956539, 0.06885478, 0.06430675, 0.0745411,
        0.06216719, 0.07274635, 0.05709888]
    data = combfit.DataTuple(z, n, dn)
    # path to data covariance matrix (only for resampling)
    # fpath = ...
    # data.setCovariance(np.loadtxt(fpath))

    # set up a model with 13 components with linear amplitudes
    n_comp = 13
    model = combfit.GaussianComb(n_comp, 0.07, 1.41 / n_comp)
    # fit the model to the data
    opt = combfit.SingleBinFit(data, model)
    bestfit = opt.optimize(n_samples=1000)
    # plot the parameter covariance
    bestfit.plotSamples()
    plt.show()
    bestfit.plotCorr()
    plt.show()
    # plot the data and best-fit model
    data.plot()
    model.plot(bestfit)
    plt.show()
